{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-[calc(100vh-64px)] px-6 py-12 text-center">
  <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-6xl w-full text-gray-800">
    <h1 class="text-3xl font-bold text-orange-500 mb-10">Matchmaking</h1>
    {% if messages %}
      <div id="messages" class="mb-8 w-full max-w-3xl mx-auto space-y-2 transition-opacity duration-500">
        {% for message in messages %}
          <div class="
            px-4 py-3 rounded-lg text-sm font-semibold shadow-md text-left
            {% if message.tags == 'success' %}
              bg-green-100 text-green-800 border border-green-300
            {% elif message.tags == 'error' %}
              bg-red-100 text-red-800 border border-red-300
            {% elif message.tags == 'warning' %}
              bg-yellow-100 text-yellow-800 border border-yellow-300
            {% else %}
              bg-blue-100 text-blue-800 border border-blue-300
            {% endif %}
          ">
            {{ message }}
          </div>
        {% endfor %}
      </div>
      <script>
        setTimeout(() => {
          const msgBox = document.getElementById('messages');
          if (msgBox) {
            msgBox.style.opacity = '0';
            setTimeout(() => msgBox.remove(), 500);
          }
        }, 3000);
      </script>
    {% endif %}
    <div class="flex justify-center gap-8 mb-10">
      <button onclick="window.location.href='{% url 'matchmaking:one_vs_one' %}'"
              class="bg-[#002B4F] text-orange-400 font-semibold px-8 py-2 rounded-full hover:bg-[#004C8B] transition">
        Buat Match 1 vs 1
      </button>
      <button onclick="window.location.href='{% url 'matchmaking:two_vs_two' %}'"
              class="bg-[#002B4F] text-orange-400 font-semibold px-8 py-2 rounded-full hover:bg-[#004C8B] transition">
        Buat Match 2 vs 2
      </button>
    </div>

    <h2 class="text-xl font-semibold text-gray-700 mb-4">Daftar Match yang Tersedia</h2>
    {% if matches %}
      <div class="overflow-x-auto">
        <table class="min-w-full text-left border-collapse border border-gray-200">
          <thead>
            <tr class="bg-[#002B4F] text-orange-300">
              <th class="px-4 py-2 border border-gray-200">Mode</th>
              <th class="px-4 py-2 border border-gray-200">Dibuat Oleh</th>
              <th class="px-4 py-2 border border-gray-200">Jumlah Pemain</th>
              <th class="px-4 py-2 border border-gray-200 text-center">Aksi</th>
            </tr>
          </thead>
          <tbody class="text-gray-700">
            {% for match in matches %}
              <tr class="border-b border-gray-200 hover:bg-gray-100 transition">
                <td class="px-4 py-2 border border-gray-200">{{ match.get_mode_display }}</td>
                <td class="px-4 py-2 border border-gray-200">{{ match.created_by.username }}</td>
                <td class="px-4 py-2 border border-gray-200">
                  {{ match.player_count }}/{{ match.max_players }}
                </td>
                <td class="px-4 py-2 border border-gray-200">
                  <div class="flex flex-wrap gap-2 justify-center items-center">

                    {% if request.user in match.players.all %}
                      <span class="text-green-700 font-semibold">Anda telah mendaftar</span>

                    {% elif match.can_join and request.user != match.created_by %}
                      <form method="post" action="{% url 'matchmaking:join_match' match.id %}">
                        {% csrf_token %}
                        <button type="submit" 
                            class="bg-green-600 text-white px-4 py-1 rounded-full hover:bg-green-700 transition">
                          Join
                        </button>
                      </form>
                    {% endif %}

                    <button onclick="window.location.href='{% url 'matchmaking:match_detail' match.id %}'"
                        class="bg-blue-600 text-white px-4 py-1 rounded-full hover:bg-blue-700 transition">
                      Details
                    </button>

                    {% if match.created_by == request.user %}
                      <form method="post" action="{% url 'matchmaking:delete_match' match.id %}">
                        {% csrf_token %}
                        <button type="submit" 
                                class="bg-red-600 text-white px-4 py-1 rounded-full hover:bg-red-700 transition">
                          Delete
                        </button>
                      </form>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
  <div class="flex flex-col items-center mt-8 text-gray-500">
    <span class="text-5xl mb-2">ðŸŒµ</span>
    <p class="text-lg">Belum ada match yang dibuat.</p>
  </div>
{% endif %}

  </div>
</div>
{% endblock %}
